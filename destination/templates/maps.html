<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa con Routes API</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiiEYgN22LfADsfaWZah1sCjhH1HLFaO0&callback=inicializarMapa" async defer></script>
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Ruta con Routes API Avanzada</h1>
    <div id="map"></div>
    <script>
        let map;
        let directionsRenderer;

        function inicializarMapa() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 4.6097, lng: -74.0817 }, // Bogotá, Colombia
                zoom: 12
            });

            directionsRenderer = new google.maps.Polyline({
                strokeColor: "#FF0000",
                strokeOpacity: 1.0,
                strokeWeight: 4,
                map: map
            });

            obtenerRuta();
        }

        async function obtenerRuta() {
            const apiKey = "AIzaSyDiiEYgN22LfADsfaWZah1sCjhH1HLFaO0";
            const url = `https://routes.googleapis.com/directions/v2:computeRoutes`;

            const requestBody = {
                origin: { location: { latLng: { latitude: 4.6097, longitude: -74.0817 } } }, // Bogotá
                destination: { location: { latLng: { latitude: 6.2442, longitude: -75.5812 } } }, // Medellín
                travelMode: "DRIVE",
                computeAlternativeRoutes: false,
                routingPreference: "TRAFFIC_AWARE",
                languageCode: "es-ES"
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Goog-Api-Key": apiKey,
                        "X-Goog-FieldMask": "routes.polyline"
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                console.log("Ruta recibida:", data);

                if (data.routes && data.routes.length > 0) {
                    mostrarRuta(data.routes[0].polyline.encodedPolyline);
                } else {
                    console.error("No se encontró una ruta válida.");
                }

            } catch (error) {
                console.error("Error al obtener la ruta:", error);
            }
        }

        function mostrarRuta(encodedPolyline) {
            const decodedPath = google.maps.geometry.encoding.decodePath(encodedPolyline);
            directionsRenderer.setPath(decodedPath);
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiiEYgN22LfADsfaWZah1sCjhH1HLFaO0&libraries=geometry"></script>
</body>
</html>
